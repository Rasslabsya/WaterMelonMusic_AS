# Отчет по 3 лабе
Выполнили: Зеленин Денис, Чебан Евгений или Илья, Миша, Прокопец Семен


### Часть 1. Поднимаем Postgres

1. Создаем директорию для работы и все нужные файлы, после чего билдим контейнеры <br><br>
![Screenshot](images/Screenshot_0.png)

2. Проверяем, что контейнеры были запущены <br><br>
![Screenshot](images/Screenshot_1.png)

3. Проверяем, что `pg-master` стал лидером, а `pg-slave` — репликой <br><br>
![Screenshot](images/Screenshot_2.png)

### Часть 2. Проверяем репликацию

1. Подключаемся к базам данных через pgAdmin по localhost и их портам <br><br>


2. Cоздаем таблицу `my_first_replication` с тестовыми столбцами и данными <br><br>
![Screenshot](images/Screenshot_3.png)
![Screenshot](images/Screenshot_4.png)

3. Видим, что в `pg-slave` создалась таблица `my_first_replication`, которая содержит такие же данные <br><br>
![Screenshot](images/Screenshot_5.png)

4. Также пробуем что-то изменить в таблице у `pg-slave` и закономерно получаем ошибку, так как данные закрыты для редактирования <br><br>
![Screenshot](images/Screenshot_6.png)
![Screenshot](images/Screenshot_7.png)
![Screenshot](images/Screenshot_8.png)
![Screenshot](images/Screenshot_9.png)

5. Не работает
![Screenshot](images/Screenshot_10.png)

### Часть 3. Делаем высокую доступность

1. Успешно подключаемся к `haproxy` <br><br>
![Screenshot](images/Screenshot_11.png)

### Часть 4. Задание
1. выключаем сейчас pg_slave (нащшего мастера )<br><br>
2. видим что теперь наш мастер изменился<br><br>
![Screenshot](images/Screenshot_12.png)
3. зукапер заметил что то не так<br><br>
![Screenshot](images/Screenshot_13.png)
4. Haproxy поyял что что не так <br><br>
![Screenshot](images/Screenshot_14.png)
5. pg-master замечает отвалившийся коннект и пытается установить повторное подключение с мастером<br><br>
![Screenshot](images/Screenshot_15.png)
6. пробуем записать и запись работает<br><br>
![Screenshot](images/Screenshot_16.png)


# Ответы на вопросы

## Разница между директивами `expose` и `ports` в Docker Compose

### Директива `expose`
- Позволяет сделать порты доступными только для других контейнеров в той же сети Docker Compose. Это значит, что сервисы могут взаимодействовать друг с другом, но доступ извне (например, с хост-машины) не предоставляется.
- Используется для внутренней связи между контейнерами, что может быть полезно для повышения безопасности, так как порты не открываются для внешнего доступа.

### Директива `ports`
- Открывает указанные порты на хост-машине, что позволяет получать доступ к сервисам извне. Например, если вы укажете порт 8008 в `ports`, он будет доступен как на хосте, так и внутри сети контейнеров.
- Эта директива позволяет не только указать порты контейнера, но и их сопоставление с портами на хосте, что дает больше контроля над сетевыми настройками.

## Перезапуск проекта Docker Compose и пересборка образов

1. **При обычном перезапуске композ-проекта**:
   - Образ не будет пересобран автоматически. Docker Compose использует уже существующий образ, если он не изменился.

2. **Изменение файлов `postgresX.yml`**:
   - Изменения в конфигурации `postgresX.yml` также не приводят к пересборке образа. Эти изменения применяются сразу без необходимости пересборки.

3. **Изменение содержимого самого `Dockerfile`**:
   - Если вы измените `Dockerfile`, образ будет пересобран только при запуске Docker Compose с флагом `--build`. Если запускать без этого флага, будет использоваться старый образ.

Таким образом, для применения изменений в конфигурации или в самом Dockerfile необходимо учитывать использование соответствующих флагов и директив.
